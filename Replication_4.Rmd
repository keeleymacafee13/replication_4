---
title: 'Replication 4: "What the Demolition of Public Housing Teaches Us about the
  Impact of Racial Threat on Political Behavior"'
author: "Keeley MacAfee"
date: "4/1/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load libraries. 
library(apsrtable)
library(tidyverse)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load data
# Some other data is loaded throughout the code.
# Tried to load it in this chunk with the Tidyversian style, but it caused errors along the way.
wtreat <- read_csv('dataverse_files/white.treat.effect.mean.boot.csv') 
wtreat.lower <- read_csv('dataverse_files/white.treat.effect.conf.boot.lower.csv') 
wtreat.upper <- read_csv('dataverse_files/white.treat.effect.conf.boot.upper.csv') 
Nwtreat <- read_csv('dataverse_files/white.treat.N.csv')
btreat <- read_csv('dataverse_files/black.treat.effect.mean.boot.csv') 
btreat.lower <- read_csv('dataverse_files/black.treat.effect.conf.boot.lower.csv') 
btreat.upper <- read_csv('dataverse_files/black.treat.effect.conf.boot.upper.csv') 
Nbtreat <- read_csv('dataverse_files/black.treat.N.csv')
##letters for marking graphs, one is not used
use.letters = c('a','b','c','d','e','f','skip','g','h')
```

# Abstract 
In "What the Demolition of Public Housing Teaches Us about the Impact of Racial Threat on Political Behavior," Ryan Enos examines the destruction of housing projects in Chicago and the effects it had on citizens' political behavior/preferences.


# Figure 1

```{r fig1, echo=FALSE, message=FALSE, warning=FALSE}
# Figure 1

# Master graphic parameters (hard coding?) for graphics
ylims = c(-.35,.1)
ylims.2 = c(-.45,.1)
xlims = c(.5,11)
dists = seq(from = 1000, to = 100, by = -100)
xs = seq(1:length(dists))
ys = seq(from = -.35, to = .1, by = .05)
ys.lab = c('-0.35','-0.30', '-0.25','-0.20','-0.15','-0.10','-0.05','0.00','0.05','0.10')
ys.2 = seq(from = -.45, to = .1, by = .05)
ys.lab.2 = c('-0.45','-0.40','-0.35','-0.30', '-0.25','-0.20','-0.15','-0.10','-0.05','0.00','0.05','0.10')

offsets = .15
text.offsets = .025
cex.axis = .9
cex.N = .7
top.text.adj = c(1.3,1.3) ##offsets on labels to reduce crowding
bottom.text.adj = c(-.15,-.85)
point.size = 2
line.offset = .0175

# Cycle through each line of data, each of which are groups defined by diferent namepcts
	use.wtreat = as.matrix(wtreat[7,])
	use.wlower = as.matrix(wtreat.lower[7,])
	use.wupper = as.matrix(wtreat.upper[7,])
	use.Nwtreat = as.matrix(Nwtreat[7,])
	
	use.btreat = as.matrix(btreat[7,])
	use.blower = as.matrix(btreat.lower[7,])
	use.bupper = as.matrix(btreat.upper[7,])
	use.Nbtreat = as.matrix(Nbtreat[7,])
	

# Name graphs/details
	par(las = 1)
	par(mar = c(5.1, 4.1, .5, .5))
	plot(xs, use.wtreat,
		ylim = ylims,
		xlim = xlims,
		type = 'n',
		ylab = 'Treatment Effect',
		xlab = 'Treated Group Distance from Projects',
		xaxt = 'n',
		yaxt = 'n.csv')
	abline(h = 0, lty = 2)

# Draw lines first so they are covered by points
# Create spaces in lines using the offset (this allows the N to be displayed with the text() function)
# Black lines are offset to the left, white lines to the right	
	
	segments(x0= xs[1:2]+offsets, x1 = xs[1:2]+offsets, 
	         
# Only do it for low N blacks because otherwise lines look funny

		y0 = use.btreat[,1:2], y1 =	use.blower[,1:2])
	segments(x0= xs[1:2]+offsets, x1 = xs[1:2]+offsets,
		y0 = use.btreat[,1:2] + line.offset, 	y1 =	use.bupper[,1:2])
	
# Now the others
	
	segments(x0= xs[3:10]+offsets, x1 = xs[3:10]+offsets,
		y0 = use.blower[,3:10], 	y1 =	use.bupper[,3:10])
	
# Bottom lines
	segments(x0= xs-offsets, x1 = xs-offsets, 
		y0 = use.wtreat - line.offset, 	y1 =	use.wlower)
	
# Top lines
	segments(x0= xs-offsets, x1 = xs-offsets, 
		y0 = use.wtreat, 	y1 =	use.wupper)

  
# Points and N descriptions
	points(xs-offsets, use.wtreat,
	       cex = point.size,
	       pch = 21, 
	       bg = 'white',
	       col = 'black')
	text(xs-offsets,use.wtreat,
	     paste('(',use.Nwtreat,')',sep = ''),
	     cex = cex.N,
	     #adj = top.text.adj
	     pos = 1)
	
	points(xs+offsets, use.btreat,
	       pch = 16,
	       cex = point.size)
	text(xs+offsets,use.btreat,
	     paste('(',use.Nbtreat,')',sep = ''),
	     cex = cex.N,
	     #adj = bottom.text.adj
	     pos = 3)
	
	axis(side = 1,
		at = xs,
		label = seq(100,1000,100),
		cex.axis = cex.axis)
	axis(side = 2,
		at = ys,
		label = ys.lab,
		cex.axis = cex.axis)	

```


# Figures 2

```{r fig 2 and 3, echo=FALSE, message=FALSE, warning=FALSE}
# Figure 2 

# Removed parts of this code by trial and error because I originally got several different 
# graphs in addition to the ones created in the paper.
# Not really sure how to separate the figures into different code chunks.
# EDIT: getting rid of for loop makes plots separable
treat <- read_csv('dataverse_files/white.match.nondemolished.csv')
diffs <- read_csv('dataverse_files/white.match.nondemolished.diffs.csv')

			use.ylims = ylims
			use.ys.lab = ys.lab
			use.ys = ys
	
			use.treat = treat$coefficient			
			clower = use.treat-(1.96*treat$stdev)
			cupper = use.treat+(1.96*treat$stdev)
			use.N.treat = treat$N.treatment + treat$N.control
						
			par(las = 1)
			par(mar = c(5.1, 4.1, .5, .5))
			plot(xs, use.treat,
				ylim = use.ylims,
				xlim = xlims,
				type = 'n',
				ylab = 'Treatment Effect',
				xlab = 'Treated Group Distance from Projects',
				xaxt = 'n',
				yaxt = 'n')
			abline(h = 0, lty = 2)
				
			segments(x0=xs,x1=xs,
						y0= use.treat+line.offset,y1=cupper)
			segments(x0=xs,x1=xs,
						y0= use.treat,y1=clower)
	
# Treatment Effects.
# Not totally sure what all of this does. 
			
			points(xs, use.treat, 
				pch = 17, 
				cex = point.size,
					bg = 'white',
       			col = 'black')
			text(xs,use.treat,
			     paste('(',use.N.treat,')',sep = ''),
			     cex = cex.N,
			     pos = 3)
			axis(side = 1,
					at = xs,
					label = seq(100,1000,100),
					cex.axis = cex.axis)
			axis(side = 2,
					at = use.ys,
					label = use.ys.lab,
					cex.axis = cex.axis)
	
```



# Figure 3

```{r fig3, echo=FALSE, message=FALSE, warning=FALSE}
treat3 <- read_csv('dataverse_files/white.match.black.property.csv')
diffs3 <- read_csv('dataverse_files/white.match.black.diffs.property.csv')

use.ylims = ylims
			use.ys.lab = ys.lab
			use.ys = ys
	
			use.treat = treat3$coefficient			
			clower = use.treat-(1.96*treat3$stdev)
			cupper = use.treat+(1.96*treat3$stdev)
			use.N.treat = treat3$N.treatment + treat3$N.control
						
			par(las = 1)
			par(mar = c(5.1, 4.1, .5, .5))
			plot(xs, use.treat,
				ylim = use.ylims,
				xlim = xlims,
				type = 'n',
				ylab = 'Treatment Effect',
				xlab = 'Treated Group Distance from Projects',
				xaxt = 'n',
				yaxt = 'n')
			abline(h = 0, lty = 2)
				
			segments(x0=xs,x1=xs,
						y0= use.treat+line.offset,y1=cupper)
			segments(x0=xs,x1=xs,
						y0= use.treat,y1=clower)
	
# Treatment Effects.
# Not totally sure what all of this does. 
			
			points(xs, use.treat, 
				pch = 17, 
				cex = point.size,
					bg = 'white',
       			col = 'black')
			text(xs,use.treat,
			     paste('(',use.N.treat,')',sep = ''),
			     cex = cex.N,
			     pos = 3)
			axis(side = 1,
					at = xs,
					label = seq(100,1000,100),
					cex.axis = cex.axis)
			axis(side = 2,
					at = use.ys,
					label = use.ys.lab,
					cex.axis = cex.axis)

```


# Figure 4

```{r fig4a, echo=FALSE, message=FALSE, warning=FALSE}
# Figure 4a

distdat = read.csv('dataverse_files/predicted.results.distance.vary.context.csv')
colnames(distdat) <- c("mean","sd","50%","2.5%","97.5%")


# New ylims for these graphs
ylims.predict = c(.6,.75)

# Parameters to be used in graphs.
xsa = seq(from = 10, to = 2000, by = 10)


		par(las = 1)
		par(mar = c(5.1, 4.1, .5, .5), mai = c(1.22,0.82,0.82,0.1))
		plot(xsa, distdat[,'mean'],
			type = 'l',
			xlab = 'Distance from Project',
			ylab = expression(Pr(vote[2004])),
			ylim = ylims.predict,
			xaxt = 'n',
			cex.axis = cex.axis,
			lwd = 4)
		
# Put horizontal and vertical lines on plots.
	abline(h = seq(from = min(ylims.predict), to = max(ylims.predict), by = .025),
	       lty = 2,
	       col = 'gray',
	       lwd = 1)
	abline(v = seq(from = 0, to = 2000, by = 200), 
	       lty = 2,
	       col = 'gray',
	       lwd = 1)
	lines(xsa, distdat[,'2.5%'],
			lty = 3,
			lwd = 2.5)
	lines(xsa, distdat[,'97.5%'],
			lty = 3,
			lwd = 2.5)

axis(side = 1, 
		at = seq(from = 0, to = 2000, by = 200),
     labels = as.character(seq(from = 0, to = 2000, by = 200)),
		cex.axis = cex.axis)
```


```{r fig4b, echo=FALSE, message=FALSE, warning=FALSE}
# Figure 4b
areadat = read.csv('dataverse_files/predicted.results.area.vary.context.csv')
colnames(areadat) <- c("mean","sd","50%","2.5%","97.5%")

# Parameters.
xsb = seq(from = 45000, to = 1004000, by = 4800)/1000

	par(las = 1)
		par(mar = c(5.1, 4.1, .5, .5), mai = c(1.22,0.82,0.82,0.1))
		plot(xsb, areadat[,'mean'],
			type = 'l',
			xlab = 'Percent of Local Black Population in Demolished Project',
			ylab = expression(Pr(vote[2004])),
			ylim = ylims.predict,
			xaxt = 'n',
			cex.axis = cex.axis,
			lwd = 4)
		
# Put horizontal and vertical lines on plots
	abline(h = seq(from = min(ylims.predict), to = max(ylims.predict), by = .025),
	       lty = 2,
	       col = 'gray',
	       lwd = 1)
	abline(v = seq(from = 0, to = 2000, by = 200), 
	       lty = 2,
	       col = 'gray',
	       lwd = 1)
	lines(xsb, areadat[,'2.5%'],
			lty = 3,
			lwd = 2.5)
	lines(xsb, areadat[,'97.5%'],
			lty = 3,
			lwd = 2.5)
	

  axis(side = 1, 
		at = seq(from = 0, to = 1000, by = 100),
		# Hard coding axis labels. Help from Enxhis code from class.
     labels = as.character(c('0','10%','20%','30%','40%','50%','60%','70%','80%','90%','100%')),
		cex.axis = cex.axis)

```


# Figures 5 and 6


```{r fig5, echo=FALSE, message=FALSE, warning=FALSE}

# Figures 5 and 6
# Again, I couldn't figure out how to break up the figures into different chunks.

pres.elections = c('dole_pct_ei','bush2000_pct_ei','bush2004_pct_ei','mccain_pct_ei')
obama.elections = c('obama_sen_primary_pct_ei','keyes_pct_ei','obama_pres_primary_pct_ei')

dists = read.csv('dataverse_files/distance.vote.differences.csv')
demos = read.csv('dataverse_files/demolished.vote.differences.csv')


graphs = c('5a','5b','6')

for(i in graphs){

	if(i == '5a'){dat = dists}
	else{dat = demos}
		
	if(i %in% c('5a','5b')){
		xlims = c(.75,4.25)
		ylims = c(-.1,.2)	
		}
	else{
		xlims = c(.75,3.25)
		ylims = c(-.1,.25)
		}

# Recode Keyes to Obama general for presentation purposes
	dat[dat$election == 'keyes_pct_ei','x.mean'] = 1 - dat[dat$election == 'keyes_pct_ei','x.mean']
	
	dat[dat$election == 'keyes_pct_ei','y.mean'] = 1 - dat[dat$election == 'keyes_pct_ei','y.mean']
	
	dat[dat$election == 'keyes_pct_ei','diff'] =dat[dat$election == 'keyes_pct_ei','y.mean'] - dat[dat$election == 'keyes_pct_ei','x.mean']
	
		par(las = 1)
		par(mar = c(5.1, 4.1, .5, 1.5))
		plot(seq(1:4),
			rep(1,4),
			ylim = ylims,
			xlim = xlims, 
			type = 'n',
			xaxt = 'n',
			yaxt = 'n',
			xlab = 'Election',
			ylab = ifelse(i == '5b','','Treatment Effect')
			)
		abline(h=0, lty = 2)
		
		if(i %in% c('5a','5b')){
			segments(
				x0= seq(1:4)-offsets, 
				x1 = seq(1:4)-offsets,
				y0 = dat[dat$group == 'white'&dat$election %in% pres.elections,'diff']-(1.96*dat[dat$group == 'white'&dat$election %in% pres.elections,'sd']),
				y1 =	dat[dat$group == 'white'&dat$election %in% pres.elections,'diff']+(1.96*dat[dat$group == 'white'&dat$election %in% pres.elections,'sd'])	
					)
			points(seq(1:4)-offsets,
				dat[dat$group == 'white'&dat$election %in% pres.elections,'diff'],
					pch = 21, 
					bg = 'white',
					col = 'black',
					cex = 2
				)
			segments(
				x0= seq(1:4)+offsets, 
				x1 = seq(1:4)+offsets,
				y0 = dat[dat$group == 'black'&dat$election %in% pres.elections,'diff']-(1.96*dat[dat$group == 'black'&dat$election %in% pres.elections,'sd']),
				y1 =	dat[dat$group == 'black'&dat$election %in% pres.elections,'diff']+(1.96*dat[dat$group == 'black'&dat$election %in% pres.elections,'sd'])	
					)
			points(seq(1:4)+offsets,
				dat[dat$group == 'black'&dat$election %in% pres.elections,'diff'],
					pch = 16,
					cex = 2
				)
			axis(side = 1, at = seq(1:4), 
				c('1996','2000','2004','2008'), 
				tick = F,
				cex.axis = cex.axis)		
		}
		
		else{
			segments(
				x0= seq(1:3)-offsets, 
				x1 = seq(1:3)-offsets,
				y0 = dat[dat$group == 'white'&dat$election %in% obama.elections,'diff']-(1.96*dat[dat$group == 'white'&dat$election %in% obama.elections,'sd']),
				y1 =	dat[dat$group == 'white'&dat$election %in% obama.elections,'diff']+(1.96*dat[dat$group == 'white'&dat$election %in% obama.elections,'sd'])
					)
		  
			points(seq(1:3)-offsets,
				dat[dat$group == 'white'&dat$election %in% obama.elections,'diff'],
					pch = 21, 
					bg = 'white',
					col = 'black',
					cex = 2
				)
			
			segments(
				x0= seq(1:3)+offsets, 
				x1 = seq(1:3)+offsets,
				y0 = dat[dat$group == 'black'&dat$election %in% obama.elections,'diff']-(1.96*dat[dat$group == 'black'&dat$election %in% obama.elections,'sd']),
				y1 =	dat[dat$group == 'black'&dat$election %in% obama.elections,'diff']+(1.96*dat[dat$group == 'black'&dat$election %in% obama.elections,'sd'])	        )
			
  			points(seq(1:3)+offsets,
				dat[dat$group == 'black'&dat$election %in% obama.elections,'diff'],
					pch = 16,
					cex = 2
				)
  			
		axis(side = 1, at = seq(1:3), 
					c('2004 \n Senate Primary','2004 \n Senate General','2008 \n President Primary'),
					tick = F,
					cex.axis = cex.axis
					)
		
		}
		
		axis(side = 2,
			at = seq(from = -.1, to = .3, by = .05),
			label = c('-0.10','-0.05','0.00','0.05','0.10','0.15','0.20','0.25','0.30'),
			cex.axis = cex.axis
			)			
	
	}		
				
```




# References

Enos, Ryan D. 2016. “What the Demolition of Public Housing Teaches Us about the Impact of Racial Threat on Political Behavior.” American Journal of Political Science 60 (1): 123-142

